<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Example 5: Stickleback morphometrics - body and armor-plate shape &#8212; phenopype 1.0.5 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Example 6: Counting and measuring freshwater snails" href="example_6_counting_snails.html" />
    <link rel="prev" title="Example 4: Video analysis - predator prey interactions" href="example_4_video_analysis_stickleback.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          phenopype</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0.5</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/mluerig/phenopype">Phenopype on Github</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Additional resources</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="tutorial_0.html">How to run the tutorials and examples using Jupyter Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_1_python_intro.html">Tutorial 1: A (very) brief python introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_2_phenopype_workflow.html">Tutorial 2: Working with phenopype (prototyping, low throughput, high throughput)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_3_managing_projects_1.html">Tutorial 3: Setting up and managing phenopype projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_4_managing_projects_2.html">Tutorial 4: Project wide actions (e.g. size and colour reference)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_5_gui_interactions.html">Tutorial 5: GUI interactions (masks, lines and drawing tools)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_6_video_analysis.html">Tutorial 6: Video analysis</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Example 5: Stickleback morphometrics - body and armor-plate shape</a><ul>
<li><a class="reference internal" href="#High-throughput-workflow">High throughput workflow</a><ul>
<li><a class="reference internal" href="#Create-project">Create project</a></li>
<li><a class="reference internal" href="#Load-project">Load project</a></li>
<li><a class="reference internal" href="#The-template">The template</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="example_4_video_analysis_stickleback.html" title="Previous Chapter: Example 4: Video analysis - predator prey interactions"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Example 4: Vi...</span>
    </a>
  </li>
  <li>
    <a href="example_6_counting_snails.html" title="Next Chapter: Example 6: Counting and measuring freshwater snails"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Example 6: Co... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/example_5_shape_stickleback.ipynb.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Example 5: Stickleback morphometrics - body and armor-plate shape</a><ul>
<li><a class="reference internal" href="#High-throughput-workflow">High throughput workflow</a><ul>
<li><a class="reference internal" href="#Create-project">Create project</a></li>
<li><a class="reference internal" href="#Load-project">Load project</a></li>
<li><a class="reference internal" href="#The-template">The template</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Example-5:-Stickleback-morphometrics---body-and-armor-plate-shape">
<h1>Example 5: Stickleback morphometrics - body and armor-plate shape<a class="headerlink" href="#Example-5:-Stickleback-morphometrics---body-and-armor-plate-shape" title="Permalink to this headline">¶</a></h1>
<p>Variation in continuous phenotypic traits like shape or area of certain structures are difficult to quantify with landmarks, because they are too complex or have no underlying assumption of homology. In this example, the number and area of armor plating was measured as a continuous trait in a two-step process: first, a mask was set around the posterior region that contains the plates, second, the red channel (highest signal-to-noise-ratio) of the image was thresholded.</p>
<p>In this example we use the <code class="docutils literal notranslate"><span class="pre">watershed</span></code> algorithm, which helps to separate detected objects into “peaks of wanted information” and “valleys of unwanted information”. The principle is explained here: <a class="reference external" href="https://docs.opencv.org/master/d3/db4/tutorial_py_watershed.html">https://docs.opencv.org/master/d3/db4/tutorial_py_watershed.html</a></p>
<div class="row; text-align: left"><div class="col-md-6"><p><img alt="Before" src="_images/ex5_before.jpg" /></p>
<p><strong>Input</strong> - Stained threespine stickleback. The size of plates at a given plate index varies within at between ecotypes (e.g. lake and stream morphs)</p>
</div><div class="col-md-6"><p><img alt="After" src="_images/ex5_after.jpg" /></p>
<p><strong>Results</strong> - After applying adaptive thresholding and watershed algorithms, the plates separate. Where this is not the case they can be separated manually.</p>
</div></div><div class="section" id="High-throughput-workflow">
<h2>High throughput workflow<a class="headerlink" href="#High-throughput-workflow" title="Permalink to this headline">¶</a></h2>
<p>First we need to create a project, as described in <a class="reference internal" href="tutorial_3_managing_projects_1.html"><span class="doc">Tutorial 3</span></a> and <a class="reference internal" href="tutorial_4_managing_projects_2.html"><span class="doc">Tutorial 4</span></a>.</p>
<p><strong>Note:</strong> If you have already created a project you can skip the following steps and load the project with <code class="docutils literal notranslate"><span class="pre">pp.project.load(&quot;path/to/project&quot;)</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">phenopype</span> <span class="k">as</span> <span class="nn">pp</span>

<span class="c1">## relative from phenopype-master/tutorials</span>
<span class="n">project_root</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;../_temp/output/ex5_project&quot;</span>
<span class="n">image_dir</span> <span class="o">=</span> <span class="s2">&quot;images&quot;</span>
<span class="n">reference_image</span> <span class="o">=</span> <span class="s2">&quot;images/stickleback_side.jpg&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="Create-project">
<h3>Create project<a class="headerlink" href="#Create-project" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ex5</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">root_dir</span><span class="o">=</span><span class="n">project_root</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--------------------------------------------
Phenopype will create a new project at
E:\git_repos\phenopype\_temp\output\ex5_project

Proceed? (y/n)
y

project attributes written to E:\git_repos\phenopype\_temp\output\ex5_project\attributes.yaml
--------------------------------------------
</pre></div></div>
</div>
<p>This will create a folder structure and allows for easy creation of the <code class="docutils literal notranslate"><span class="pre">pype</span></code>-configuration files needed for high throughput. First we add the image files in the directory, but only “stickle1”, “stickle2”, and “stickle3”.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ex5</span><span class="o">.</span><span class="n">add_files</span><span class="p">(</span><span class="n">image_dir</span><span class="o">=</span><span class="n">image_dir</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="s2">&quot;stickle&quot;</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;side&quot;</span><span class="p">,</span><span class="s2">&quot;top&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--------------------------------------------
phenopype will search for files at

E:\git_repos\phenopype\tutorials\images

using the following settings:

filetypes: [&#39;jpg&#39;, &#39;JPG&#39;, &#39;jpeg&#39;, &#39;JPEG&#39;, &#39;tif&#39;, &#39;png&#39;], include: stickle, exclude: [&#39;side&#39;, &#39;top&#39;], raw_mode: copy, search_mode: dir, unique_mode: path

Found image stickle1.JPG - phenopype-project folder 0__stickle1 created
dirpath defaulted to file directory - E:\git_repos\phenopype\tutorials\images
Directory to save files set at - E:\git_repos\phenopype\tutorials\images
no meta-data found
Found image stickle2.JPG - phenopype-project folder 0__stickle2 created
dirpath defaulted to file directory - E:\git_repos\phenopype\tutorials\images
Directory to save files set at - E:\git_repos\phenopype\tutorials\images
no meta-data found
Found image stickle3.JPG - phenopype-project folder 0__stickle3 created
dirpath defaulted to file directory - E:\git_repos\phenopype\tutorials\images
Directory to save files set at - E:\git_repos\phenopype\tutorials\images
no meta-data found

Found 3 files
--------------------------------------------
</pre></div></div>
</div>
<p>Now we add the appropriate configuration file. As for the other examples I have created a preset (“ex5”) with appropriate settings, which is passed to the pype using <code class="docutils literal notranslate"><span class="pre">config_preset=&quot;ex5&quot;</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ex5</span><span class="o">.</span><span class="n">add_config</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="n">config_preset</span><span class="o">=</span><span class="s2">&quot;ex5&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">presets</span><span class="o">.</span><span class="n">ex5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
pype config generated from ex5.
pype_v1.yaml created for 0__stickle1
pype_v1.yaml created for 0__stickle2
pype_v1.yaml created for 0__stickle3

preprocessing:
- create_mask:
    tool: polygon
- find_scale
- enter_data:
    columns: ID
segmentation:
- blur:
    kernel_size: 9
- threshold:
    method: adaptive
    blocksize: 99
    constant: 3
    channel: red
- morphology:
    operation: close
    shape: ellipse
    kernel_size: 3
    iterations: 3
- watershed:
    distance_cutoff: 0.8
# - draw:
    # line_colour: white
    # overwrite: True
- find_contours:
    retrieval: ccomp
    min_area: 100
measurement:
visualization:
- select_canvas:
    canvas: red
- draw_contours:
    line_width: 2
    label_width: 0
    label_size: 1
    fill: 0.3
- draw_masks
export:
- save_contours:
    overwrite: true

</pre></div></div>
</div>
<p>Now we add reference image to create a scale-template so we can adjust our landmark coordinate space. This is important if for example the distance between the camera and your sample changes.</p>
<center><div style="width:500px; text-align: left"><p><img alt="Adding a scale" src="_images/ex2_scale.gif" /></p>
</div></center><div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ex5</span><span class="o">.</span><span class="n">add_scale</span><span class="p">(</span><span class="n">reference_image</span> <span class="o">=</span> <span class="n">reference_image</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
- scale template saved under E:\git_repos\phenopype\_temp\output\ex5_project\scale_template.jpg.
- measure pixel-to-mm-ratio
Scale set
- add column length
Template selected
added scale information to 0__stickle1
added scale information to 0__stickle2
added scale information to 0__stickle3
</pre></div></div>
</div>
<p>Afterwards, we save the project (to the root folder).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pp</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">ex5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Project data saved under E:\git_repos\phenopype\_temp\output\ex5_project\project.data.
</pre></div></div>
</div>
</div>
<div class="section" id="Load-project">
<h3>Load project<a class="headerlink" href="#Load-project" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ex5</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">project_root</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--------------------------------------------
Project loaded from
E:\git_repos\phenopype\_temp\output\ex5_project
--------------------------------------------
</pre></div></div>
</div>
</div>
<div class="section" id="The-template">
<h3>The template<a class="headerlink" href="#The-template" title="Permalink to this headline">¶</a></h3>
<p>The basic points of the preprocessing procedure are:</p>
<ol class="arabic simple">
<li><p>Draw a mask around the area of interest (i.e. the plates)</p></li>
<li><p>Let the algorithm find the scale</p></li>
<li><p>Enter the ID from the reference card into the mask</p></li>
</ol>
<center><div style="width:500px; text-align: left"><p><img alt="Create masks" src="_images/masks2.gif" /></p>
</div></center><p>The rest is automatic: a watershed algorithm helps to separate the plates. Sensitivity of the algorithm can be mostly controlled with the <code class="docutils literal notranslate"><span class="pre">distance_cutoff</span></code> argument, but also playing around with the thresholding arguments (<code class="docutils literal notranslate"><span class="pre">blocksize</span></code> and <code class="docutils literal notranslate"><span class="pre">constant</span></code>) can help to improve results.</p>
<p>Sometimes the overall results are goog except for one or two cases of plates that touch each other. In this case, the <code class="docutils literal notranslate"><span class="pre">draw</span></code> function can be used to separate those plates without changing the whole procedure.</p>
<p>Now we can run the <code class="docutils literal notranslate"><span class="pre">pype</span></code> routine with a simple loop on <code class="docutils literal notranslate"><span class="pre">ex5.dirpaths</span></code>, which is a list of all project directories that contain the copied raw images and the config files we generated before. Interrupt the loop with Esc. To resume to the point where you left, add the <code class="docutils literal notranslate"><span class="pre">skip</span></code> argument so directory with processed files are not run again.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">dirpath</span> <span class="ow">in</span> <span class="n">ex5</span><span class="o">.</span><span class="n">dirpaths</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">pype</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
E:\git_repos\phenopype\_temp\output\ex5_project\data\0__stickle1\pype_config_v1.yaml


------------+++ new pype iteration 2020:05:18 19:34:15 +++--------------


AUTOLOAD
- template scale information loaded from attributes.yaml
- template loaded from root directory
PREPROCESSING
create_mask
- create mask
find_scale
---------------------------------------------------
Reference card found with 241 keypoint matches:
template image has 36 pixel per mm.
current image has 34.8 pixel per mm.
= 96.782 % of template image.
---------------------------------------------------
enter_data
- add column ID
SEGMENTATION
blur
threshold
- include mask &#34;mask1&#34; pixels
- exclude mask &#34;scale&#34; pixels
morphology
watershed
find_contours
VISUALIZATION
select_canvas
- red channel
draw_contours
draw_masks
 - show mask: mask1.
 - show mask: scale.
EXPORT
save_contours
- contours saved under E:\git_repos\phenopype\_temp\output\ex5_project\data\0__stickle1\contours_v1.csv.
AUTOSAVE
save_canvas
- canvas saved under E:\git_repos\phenopype\_temp\output\ex5_project\data\0__stickle1\canvas_v1.jpg.
save_data_entry
- add column ID
save_masks
- masks saved under E:\git_repos\phenopype\_temp\output\ex5_project\data\0__stickle1\masks_v1.csv.
save_scale
- save scale to attributes


TERMINATE
E:\git_repos\phenopype\_temp\output\ex5_project\data\0__stickle2\pype_config_v1.yaml


------------+++ new pype iteration 2020:05:18 19:34:30 +++--------------


AUTOLOAD
- template scale information loaded from attributes.yaml
- template loaded from root directory
PREPROCESSING
create_mask
- create mask
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-intense-fg ansi-bold">SystemExit</span><span class="ansi-red-intense-fg ansi-bold">:</span>

TERMINATE (by user)

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING: To exit: use &#39;exit&#39;, &#39;quit&#39;, or Ctrl-D.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## inspect results</span>
<span class="c1">## DataFrame</span>
<span class="n">out</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">df_contours</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="s2">&quot;idx_child&quot;</span><span class="p">,</span> <span class="s2">&quot;idx_parent&quot;</span><span class="p">,</span> <span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>filename</th>
      <th>width</th>
      <th>height</th>
      <th>size_ratio_original</th>
      <th>template_px_mm_ratio</th>
      <th>current_px_mm_ratio</th>
      <th>ID</th>
      <th>contour</th>
      <th>center</th>
      <th>diameter</th>
      <th>area</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>stickle1.JPG</td>
      <td>2400</td>
      <td>1600</td>
      <td>1</td>
      <td>36</td>
      <td>34.8</td>
      <td>142501</td>
      <td>1</td>
      <td>(1770, 400)</td>
      <td>14</td>
      <td>122</td>
    </tr>
    <tr>
      <th>1</th>
      <td>stickle1.JPG</td>
      <td>2400</td>
      <td>1600</td>
      <td>1</td>
      <td>36</td>
      <td>34.8</td>
      <td>142501</td>
      <td>2</td>
      <td>(1800, 399)</td>
      <td>20</td>
      <td>207</td>
    </tr>
    <tr>
      <th>2</th>
      <td>stickle1.JPG</td>
      <td>2400</td>
      <td>1600</td>
      <td>1</td>
      <td>36</td>
      <td>34.8</td>
      <td>142501</td>
      <td>3</td>
      <td>(1743, 396)</td>
      <td>20</td>
      <td>193</td>
    </tr>
    <tr>
      <th>3</th>
      <td>stickle1.JPG</td>
      <td>2400</td>
      <td>1600</td>
      <td>1</td>
      <td>36</td>
      <td>34.8</td>
      <td>142501</td>
      <td>4</td>
      <td>(1717, 396)</td>
      <td>24</td>
      <td>232</td>
    </tr>
    <tr>
      <th>4</th>
      <td>stickle1.JPG</td>
      <td>2400</td>
      <td>1600</td>
      <td>1</td>
      <td>36</td>
      <td>34.8</td>
      <td>142501</td>
      <td>5</td>
      <td>(1690, 391)</td>
      <td>39</td>
      <td>426</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>10</th>
      <td>stickle1.JPG</td>
      <td>2400</td>
      <td>1600</td>
      <td>1</td>
      <td>36</td>
      <td>34.8</td>
      <td>142501</td>
      <td>11</td>
      <td>(1521, 365)</td>
      <td>101</td>
      <td>1235</td>
    </tr>
    <tr>
      <th>11</th>
      <td>stickle1.JPG</td>
      <td>2400</td>
      <td>1600</td>
      <td>1</td>
      <td>36</td>
      <td>34.8</td>
      <td>142501</td>
      <td>12</td>
      <td>(1485, 360)</td>
      <td>114</td>
      <td>1559</td>
    </tr>
    <tr>
      <th>12</th>
      <td>stickle1.JPG</td>
      <td>2400</td>
      <td>1600</td>
      <td>1</td>
      <td>36</td>
      <td>34.8</td>
      <td>142501</td>
      <td>13</td>
      <td>(1453, 355)</td>
      <td>119</td>
      <td>1638</td>
    </tr>
    <tr>
      <th>13</th>
      <td>stickle1.JPG</td>
      <td>2400</td>
      <td>1600</td>
      <td>1</td>
      <td>36</td>
      <td>34.8</td>
      <td>142501</td>
      <td>14</td>
      <td>(1423, 355)</td>
      <td>128</td>
      <td>1755</td>
    </tr>
    <tr>
      <th>14</th>
      <td>stickle1.JPG</td>
      <td>2400</td>
      <td>1600</td>
      <td>1</td>
      <td>36</td>
      <td>34.8</td>
      <td>142501</td>
      <td>15</td>
      <td>(1391, 344)</td>
      <td>115</td>
      <td>1542</td>
    </tr>
  </tbody>
</table>
<p>15 rows × 11 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## image</span>
<span class="n">pp</span><span class="o">.</span><span class="n">show_image</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Moritz Lürig.<br/>
      Last updated on May 18, 2020, 7:38:48 PM.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>